---
layout: post
title: OpenMP
date: 2020-05-29
author: Max.C
header-img: 'assets/img/pro54.jpg'
catalog: true
tags: OpenMP
---



## 一、OpenMP



使用命令`gcc filename.c -o filename -fopenmp`进行编译即可。



## 二、指令与变量

OpenMP中一个变量可以有三种类型，即`shared`、`private`和`reduction`，默认为shared；在并行for循环中紧临`parallel for`语句的循环变量是私有的；并行区域代码块里的声明的变量是私有的；所有通过`private`，`firstprivate`，`lastprivate`和`reduction`子句声明的变量为私有变量。

#### private



#### firstprivate



#### lastprivate



### single

被声明的部分仅允许一个线程执行，不限定所执行的线程。

`#pragma omp single`

`#pragma omp master`



### sections、section

让不同线程执行不同代码，先声明`sections`，在其中声明独立的`section`，不同的`section`由不同的线程执行，每一个`section`仅由一个线程执行。

```

```



### reduction

归并，对应一类数据类型，一般应用在`parallel`、`for`、`sections`中，声明方式如下：

```assembly
#pragma omp ... reduction (op:list)
```

op：操作类型，`+  -  *  ^  &  |  &&  ||`

list：操作数

```cpp
#pragma omp parallel for reduction (+:sum)
for(int i=0;i<10;i++)
	sum += i;
```



## 三、竞争与同步

### 1、barrier

显式：`#pragma omp barrier`

隐式：`for、single`会自动添加障碍；

```c
#include <stdio.h>
#include <stdlib.h>
#include <omp.h>

int main()
{
    int nthreads,tid;

    # pragma omp parallel private(tid)
    {
        tid = omp_get_thread_num();
        printf("hello world from thread = %d\n",tid);
        #pragma omp barrier
        printf("hi world from thread = %d\n",tid);
    }
    return 0;
}
```

```assembly
# 执行结果
max@max-MIIX-510-12ISK:~/parall/OpenMP$ gcc barrier.c  -o barrier -fopenmp
max@max-MIIX-510-12ISK:~/parall/OpenMP$ ./barrier 
hello world from thread = 0
hello world from thread = 2
hello world from thread = 3
hello world from thread = 1
hi world from thread = 0
hi world from thread = 2
hi world from thread = 1
hi world from thread = 3
```



### 2、nowait

取消屏障：`#pragma omp nowait`，优先级比`barrier`更高，可在`for、single`中使用；



## 参考资料

[OpenMP--private, shared变量](https://blog.csdn.net/s170262941/article/details/11521981)